<!doctype html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>PaD Calculator</title>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type='text/javascript'>

        (function(w, s) {

            /**
             * shim Dave.now function
             */

            if (!w.Date.now) {
                w.Date.now = function() {
                    return (new Date()).getTime();
                }
            }


            /**
             * window.Object shim
             * to support keys method
             */

            // create window.Object if it does not exist
            if (!w.Object) {
                w.Object = function() {};
            }

            // add a keys method if it does not exist
            if (!w.Object.keys) {
                w.Object.prototype.keys = function(object) {
                    var keys = [];
                    for (var x in object) {
                        keys.push(x);
                    }
                    return keys;
                }
            }


            /**
             * LocalStorage Shim
             * adds support for localstorage functionality, but does not
             */

            var LocalStorage = function() {
                this.store = {};
            }

            LocalStorage.prototype.setItem = function(key, value) {
                this.store[key] = value;
            }

            LocalStorage.prototype.getItem = function(key) {
                return this.store[key];
            }

            LocalStorage.prototype.removeItem = function(key) {
                delete(this.store[key]);
            }

            LocalStorage.prototype.clear = function() {
                delete(this.store);
                this.store = {};
            }

            LocalStorage.prototype.key = function(index) {
                var keys = w.Object.keys(this.store);
                return this.store[keys[index]];
            }

            LocalStorage.prototype.length = function() {
                return w.Object.keys(this.store).length;
            }

            if (!w.localStorage) {
                w.localStorage = new LocalStorage();
            }


            /**
             * Storage cache wrapper
             */

            var Storage = function() {
                this.localStorage = w.localStorage;
            };

            Storage.prototype.expires = 300000; // 5 minutes * 60 seconds * 1000 milliseconds

            Storage.prototype.setExpires = function(expires_in_minutes) {
                this.expires = (expires_in_minutes * 60 * 1000);
            }

            Storage.prototype.get = function(key, fallback) {

                // retreive value
                var value = this.localStorage.getItem(key);

                // check for data
                if (value) {
                    var json = w.JSON.parse(value);

                    // Has it expired?
                    if (json.expires < Date.now()) {
                        delete(value);
                        this.localStorage.removeItem(key);
                    } else {
                        value = json.data;
                    }
                }

                // return value or fallback
                return value || fallback;
            };

            Storage.prototype.set = function(key, value, expires) {

                // fallback expires to this.expires
                expires = expires ? (expires * 60 * 1000) : this.expires;

                // prepare data to store
                var data = {
                    "expires": Date.now() + expires,
                    "data": value
                }

                // store data
                this.localStorage.setItem(key, w.JSON.stringify(data));
            };

            Storage.prototype.clear = function() {
                this.localStorage.clear();
            };


            // make storage service global
            w[s] = new Storage();

        })(window, "storage");



        $(document).ready(function() {


            var properties = [
                "atk_max",
                "atk_min",
                "name",
                "max_level",
            ];

            // a function is also an object
            var Monster = function(monster) {
                for (var i in properties) {
                    if (typeof monster[properties[i]] != "undefined") {
                        this[properties[i]] = monster[properties[i]];
                    }
                }
            };
            }

            // load monsters or empty array
            var monsters = window.storage.get("monsters", []);

            var getUserData = function(username) {
                // request user information
                $.get("https://www.padherder.com/user-api/user/" + username + "/", function(data) {
                    console.log(data);
                    //KonatsuMain
                });
            }

            $(".getUser").on("click", function(e) {
                if (e && e.preventDefault) e.preventDefault();

                // get username
                var username = $("input").first().val();

                // load monsters if not yet loaded
                if (!monsters.length) {
                    $.get("https://www.padherder.com/api/monsters/", function(data) {
                        for (var i in data) {
                            monsters.push(new Monster(data[i]));
                        }
                        window.storage.set('monsters', monsters, 1440);
                        getUserData();
                    }, "json");
                } else {
                    getUserData();
                }

                return false;
            });

        });

    </script>

    <style type='text/css'>

        * {
            margin: 0;
            padding: 0;
        }

        body {
            width: 80%;
            margin: 25px auto;
        }

        input {
            border-radius: 5px;
            border: 1px solid #ccc;
            color: #333;
        }

        input, button, p {
            padding: 3px 10px;
            margin-bottom: 5px;
        }

    </style>

</head>
<body>

    <p>Username is case sensative.</p>

    <form method="post" action="#">
        <p><input type="text" placeholder="username..." /></p>
        <p><button class="getUser">Pull User</button></p>
    </form>


    <p id="banana">I have an id of banana</p>
    <p class="poll">I have a class of poll</p>


</body>
</html>